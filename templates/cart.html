<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Selected Items</title>
    <link rel="stylesheet" href="/static/cart.css" />
  </head>
  <body>
    <h2>Selected Items</h2>

    <table id="cartTable">
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price (₹)</th>
          <th>Amount (₹)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="buyNowBtn" disabled>Buy Now</button>

    <script>
      function getCart() {
        const cart = localStorage.getItem("cart");
        return cart ? JSON.parse(cart) : [];
      }
      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function renderCart() {
        const cart = getCart();
        const tbody = document.querySelector("#cartTable tbody");
        tbody.innerHTML = "";
        let totalQty = 0;

        cart.forEach((item, idx) => {
          const tr = document.createElement("tr");
          const amount = (item.price * item.quantity).toFixed(2);

          tr.innerHTML = `
        <td>${item.product_name}</td>
        <td>${item.quantity}</td>
        <td>${item.price.toFixed(2)}</td>
        <td>${amount}</td>
        <td><button data-idx="${idx}">Delete</button></td>
      `;
          tbody.appendChild(tr);
          totalQty += item.quantity;
        });

        document.getElementById("buyNowBtn").disabled = cart.length === 0;
      }

      document
        .querySelector("#cartTable tbody")
        .addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            const idx = e.target.getAttribute("data-idx");
            let cart = getCart();
            cart.splice(idx, 1);
            saveCart(cart);
            renderCart();
          }
        });

      document.getElementById("buyNowBtn").addEventListener("click", () => {
        window.location.href = "payment.html";
      });

      renderCart();
    </script>
  </body>
</html>
